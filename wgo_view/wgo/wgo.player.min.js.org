/*! MIT license, more info: wgo.waltheri.net */(function(b,l){var f=function(n){var c=new u(JSON.parse(JSON.stringify(n.getProperties()))),a;for(a in n.children)c.appendChild(f(n.children[a]));return c},k=function(n,c){var a;if(c[n]!==l)return c[n];for(var g in c.children)if(a=k(n,c.children[g]))return a;return!1},h=function(c,a){c.push(JSON.parse(JSON.stringify(a.getProperties())));if(1<a.children.length){for(var n=[],g=0;g<a.children.length;g++){var e=[];h(e,a.children[g]);n.push(e)}c.push(n)}else a.children.length&&h(c,a.children[0])},m=function(c,
a){for(var n,g=1;g<c.length;g++)if(c[g].constructor==Array)for(var e=0;e<c[g].length;e++)n=new u(c[g][e][0]),a.appendChild(n),m(c[g][e],n);else n=new u(c[g]),a.insertAfter(n),a=n},d=function(c){return"string"==typeof c?c.replace(/\\/g,"\\\\").replace(/]/g,"\\]"):c},a=function(c,a){return String.fromCharCode(97+c)+String.fromCharCode(97+a)},g=function(c,a,g){if(a.length){g.sgf+=c;for(var n in a)g.sgf+="["+a[n]+"]"}},p=function(c,e){if(c.move){var n="";c.move.pass||(n=a(c.move.x,c.move.y));e.sgf=c.move.c==
b.B?e.sgf+("B["+n+"]"):e.sgf+("W["+n+"]")}if(c.setup){n=[];var m=[],A=[];for(f in c.setup)c.setup[f].c==b.B?n.push(a(c.setup[f].x,c.setup[f].y)):c.setup[f].c==b.W?m.push(a(c.setup[f].x,c.setup[f].y)):A.push(a(c.setup[f].x,c.setup[f].y));g("AB",n,e);g("AW",m,e);g("AE",A,e)}if(c.markup){n={};for(f in c.markup)n[c.markup[f].type]=n[c.markup[f].type]||[],"LB"==c.markup[f].type?n.LB.push(a(c.markup[f].x,c.markup[f].y)+":"+d(c.markup[f].text)):n[c.markup[f].type].push(a(c.markup[f].x,c.markup[f].y));for(var q in n)g(q,
n[q],e)}var f=c.getProperties();for(q in f)"object"!=typeof f[q]&&(e.sgf="turn"==q?e.sgf+("PL["+(f[q]==b.B?"B":"W")+"]"):"comment"==q?e.sgf+("C["+d(f[q])+"]"):e.sgf+(q+"["+d(f[q])+"]"));if(1==c.children.length)e.sgf+="\n;",p(c.children[0],e);else if(1<c.children.length)for(q in c.children)f=c.children[q],n=e,n.sgf+="(\n;",p(f,n),n.sgf+="\n)"},e=function(){this.size=19;this.info={};this.root=new u;this.propertyCount=this.nodeCount=0};e.prototype={constructor:e,clone:function(){var c=new e;c.size=this.size;
c.info=JSON.parse(JSON.stringify(this.info));c.root=f(this.root);c.nodeCount=this.nodeCount;c.propertyCount=this.propertyCount;return c},hasComments:function(){return!!k("comment",this.root)}};e.fromSgf=function(c){return b.SGF.parse(c)};e.fromJGO=function(c){c="string"==typeof c?JSON.parse(c):c;var a=new e;a.info=JSON.parse(JSON.stringify(c.info));a.size=c.size;a.nodeCount=c.nodeCount;a.propertyCount=c.propertyCount;a.root=new u(c.game[0]);m(c.game,a.root);return a};e.prototype.toSgf=function(){var c=
{sgf:"(\n;"},a={},e;for(e in this.info)"black"==e?(this.info.black.name&&(a.PB=d(this.info.black.name)),this.info.black.rank&&(a.BR=d(this.info.black.rank)),this.info.black.team&&(a.BT=d(this.info.black.team))):"white"==e?(this.info.white.name&&(a.PW=d(this.info.white.name)),this.info.white.rank&&(a.WR=d(this.info.white.rank)),this.info.white.team&&(a.WT=d(this.info.white.team))):a[e]=d(this.info[e]);this.size&&(a.SZ=this.size);a.AP||(a.AP="WGo.js:2");a.FF||(a.FF="4");a.GM||(a.GM="1");a.CA||(a.CA=
"UTF-8");for(e in a)a[e]&&(c.sgf+=e+"["+a[e]+"]");p(this.root,c);c.sgf+=")";return c.sgf};e.prototype.toJGO=function(c){var a={};a.size=this.size;a.info=JSON.parse(JSON.stringify(this.info));a.nodeCount=this.nodeCount;a.propertyCount=this.propertyCount;a.game=[];h(a.game,this.root);return c?JSON.stringify(a):a};var v=function(c){if(c.name){var a=b.filterHTML(c.name);c.rank&&(a+=" ("+b.filterHTML(c.rank)+")");c.team&&(a+=", "+b.filterHTML(c.team))}else c.team&&(a=b.filterHTML(c.team)),c.rank&&(a+=
" ("+b.filterHTML(c.rank)+")");return a};e.infoFormatters={black:v,white:v,TM:function(c){if(0==c)return b.t("none");var a,e=Math.floor(c/60);1==e?a="1 "+b.t("minute"):1<e&&(a=e+" "+b.t("minutes"));e=c%60;1==e?a+=" 1 "+b.t("second"):1<e&&(a+=" "+e+" "+b.t("seconds"));return a},RE:function(c){return'<a href="javascript: void(0)" onclick="this.parentNode.innerHTML = \''+b.filterHTML(c)+'\'" title="'+b.t("res-show-tip")+'">'+b.t("show")+"</a>"}};e.infoList="black white AN CP DT EV GN GC HA ON OT RE RO RU SO TM US PC KM".split(" ");
b.Kifu=e;var c=function(c,a,e){for(var g=0;g<c.length;g++)if(c[g].x==a.x&&c[g].y==a.y){c[g][e]=a[e];return}c.push(a)},q=function(c,a){if(c)for(var e=0;e<c.length;e++)if(c[e].x==a.x&&c[e].y==a.y){c.splice(e,1);break}},u=function(c,a){this.parent=a||null;this.children=[];if(c)for(var e in c)this[e]=c[e]};u.prototype={constructor:u,getChild:function(c){c=c||0;return this.children[c]?this.children[c]:null},addSetup:function(a){this.setup=this.setup||[];c(this.setup,a,"c");return this},removeSetup:function(c){q(this.setup,
c);return this},addMarkup:function(a){this.markup=this.markup||[];c(this.markup,a,"type");return this},removeMarkup:function(c){q(this.markup,c);return this},remove:function(){var c=this.parent;if(!c)throw new Exception("Root node cannot be removed");for(var a in c.children)if(c.children[a]==this){c.children.splice(a,1);break}c.children=c.children.concat(this.children);this.parent=null;return c},insertAfter:function(c){for(var a in this.children)this.children[a].parent=c;c.children=c.children.concat(this.children);
c.parent=this;this.children=[c];return c},appendChild:function(c){c.parent=this;this.children.push(c);return c},getProperties:function(){var c={},a;for(a in this)this.hasOwnProperty(a)&&"children"!=a&&"parent"!=a&&"_"!=a[0]&&(c[a]=this[a]);return c}};b.KNode=u;var r=function(c,a){for(var e=c.size,g=[],d=[],b=0;b<e*e;b++)c.schema[b]&&!a.schema[b]?d.push({x:Math.floor(b/e),y:b%e}):c.schema[b]!=a.schema[b]&&g.push({x:Math.floor(b/e),y:b%e,c:a.schema[b]});return{add:g,remove:d}};v=function(c,a,e){this.kifu=
c;this.node=this.kifu.root;this.allow_illegal=e||!1;this.game=new b.Game(this.kifu.size,this.allow_illegal?"NONE":"KO",this.allow_illegal,this.allow_illegal);this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=b.W);this.change=y(this.game,this.node,!0);this.rememberPath=a?!0:!1};var w=function(c,a){var e=[],g;for(g in c){var b=!0;for(var d in a)if(c[g].x==a[d].x&&c[g].y==a[d].y){b=!1;break}b&&e.push(c[g])}return e},y=function(c,a,e){a.parent&&(a.parent._last_selected=a.parent.children.indexOf(a));
if(a.move!=l){if(a.move.pass)return c.pass(a.move.c),{add:[],remove:[]};c=c.play(a.move.x,a.move.y,a.move.c);if("number"==typeof c)throw new x(c,a);for(var g in c)if(c[g].x==a.move.x&&c[g].y==a.move.y)return{add:[],remove:c};return{add:[a.move],remove:c}}e||c.pushPosition();e=[];var b=[];if(a.setup!=l)for(g in a.setup)a.setup[g].c?(c.setStone(a.setup[g].x,a.setup[g].y,a.setup[g].c),e.push(a.setup[g])):(c.removeStone(a.setup[g].x,a.setup[g].y),b.push(a.setup[g]));a.turn&&(c.turn=a.turn);return{add:e,
remove:b}},z=function(c){c===l&&this.rememberPath&&(c=this.node._last_selected);c=c||0;var a=this.node.children[c];if(!a)return!1;var e=y(this.game,a);this.path.m++;1<this.node.children.length&&(this.path[this.path.m]=c);this.node=a;return e},B=function(){if(!this.node.parent)return!1;this.node=this.node.parent;this.game.popPosition();this.node.turn&&(this.game.turn=this.node.turn);this.path[this.path.m]!==l&&delete this.path[this.path.m];this.path.m--;return!0},C=function(){this.game.firstPosition();
this.node=this.kifu.root;this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=b.W);this.change=y(this.game,this.node,!0)};v.prototype={constructor:v,next:function(c){this.change=z.call(this,c);return this},last:function(){var c;for(this.change={add:[],remove:[]};c=z.call(this);){var a=this.change;a.add=w(a.add,c.remove).concat(c.add);a.remove=w(a.remove,c.add).concat(c.remove)}return this},previous:function(){var c=this.game.getPosition();B.call(this);this.change=r(c,this.game.getPosition());
return this},first:function(){var c=this.game.getPosition();C.call(this);this.change=r(c,this.game.getPosition());return this},goTo:function(c){if(c===l)return this;var a=this.game.getPosition();C.call(this);for(var e=0;e<c.m&&z.call(this,c[e+1]);e++);this.change=r(a,this.game.getPosition());return this},previousFork:function(){for(var c=this.game.getPosition();B.call(this)&&1==this.node.children.length;);this.change=r(c,this.game.getPosition());return this},getPosition:function(){return this.game.getPosition()},
allowIllegalMoves:function(c){c?(this.game.allow_rewrite=!0,this.game.allow_suicide=!0,this.repeating="NONE"):(this.game.allow_rewrite=!1,this.game.allow_suicide=!1,this.repeating="KO")}};b.KifuReader=v;var x=function(c,a){this.name="InvalidMoveError";this.message="Invalid move in kifu detected. ";if(a.move&&a.move.c!==l&&a.move.x!==l&&a.move.y!==l){var e=a.move.x;7<a.move.x&&e++;String.fromCharCode(e+65);this.message+="Trying to play "+(a.move.c==b.WHITE?"white":"black")+" move on "+String.fromCharCode(a.move.x+
65)+""+(19-a.move.y)}else this.message+="Move object doesn't contain arbitrary attributes.";if(c)switch(c){case 1:this.message+=", but these coordinates are not on board.";break;case 2:this.message+=", but there already is a stone.";break;case 3:this.message+=", but this move is a suicide.";break;case 4:this.message+=", but this position already occured."}else this.message+="."};x.prototype=Error();x.prototype.constructor=x;b.InvalidMoveError=x;b.i18n.en.show="show";b.i18n.en["res-show-tip"]="Click to show result."})(WGo);(function(b,l){b.SGF={};l=function(a,g,b,e,d,c){g=c==g?"black":"white";b.info[g]=b.info[g]||{};b.info[g][a]=d[0]};var f=b.SGF.properties={};f.B=f.W=function(a,g,d,e){g.move=!d[0]||19>=a.size&&"tt"==d[0]?{pass:!0,c:"B"==e?b.B:b.W}:{x:d[0].charCodeAt(0)-97,y:d[0].charCodeAt(1)-97,c:"B"==e?b.B:b.W}};f.AB=f.AW=function(a,g,d,e){for(var m in d)g.addSetup({x:d[m].charCodeAt(0)-97,y:d[m].charCodeAt(1)-97,c:"AB"==e?b.B:b.W})};f.AE=function(a,g,d){for(var e in d)g.addSetup({x:d[e].charCodeAt(0)-97,y:d[e].charCodeAt(1)-
97})};f.PL=function(a,g,d){g.turn="b"==d[0]||"B"==d[0]?b.B:b.W};f.C=function(a,g,d){g.comment=d.join()};f.LB=function(a,g,d){for(var e in d)g.addMarkup({x:d[e].charCodeAt(0)-97,y:d[e].charCodeAt(1)-97,type:"LB",text:d[e].substr(3)})};f.CR=f.SQ=f.TR=f.SL=f.MA=function(a,g,d,e){for(var b in d)g.addMarkup({x:d[b].charCodeAt(0)-97,y:d[b].charCodeAt(1)-97,type:e})};f.SZ=function(a,g,d){a.size=parseInt(d[0])};f.BR=f.WR=l.bind(this,"rank","BR");f.PB=f.PW=l.bind(this,"name","PB");f.BT=f.WT=l.bind(this,"team",
"BT");f.TM=function(a,g,d,e){a.info[e]=d[0];g.BL=d[0];g.WL=d[0]};var k=/\(|\)|(;(\s*[A-Z]+(\s*((\[\])|(\[(.|\s)*?([^\\]\]))))+)*)/g,h=/[A-Z]+(\s*((\[\])|(\[(.|\s)*?([^\\]\]))))+/g,m=/[A-Z]+/,d=/(\[\])|(\[(.|\s)*?([^\\]\]))/g;b.SGF.parse=function(a){var g=[],f=new b.Kifu,e=null;a=a.match(k);for(var v in a)if("("==a[v])g.push(e);else if(")"==a[v])e=g.pop();else{e&&f.nodeCount++;e=e?e.appendChild(new b.KNode):f.root;var c=a[v].match(h)||[];f.propertyCount+=c.length;for(var q in c){var l=m.exec(c[q])[0];
var r=c[q].match(d);for(var w in r)r[w]=r[w].substring(1,r[w].length-1).replace(/\\(?!\\)/g,"");if(b.SGF.properties[l])b.SGF.properties[l](f,e,r,l);else 1>=r.length&&(r=r[0]),e.parent?e[l]=r:f.info[l]=r}}return f}})(WGo);(function(b){var l=function(c,a){this.name="FileError";this.message=1==a?"File '"+c+"' is empty.":2==a?"Network error. It is not possible to read '"+c+"'.":"File '"+c+"' hasn't been found on server."};l.prototype=Error();l.prototype.constructor=l;b.FileError=l;var f=b.loadFromUrl=function(c,a){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status){if(0==e.responseText.length)throw new l(c,1);a(e.responseText)}else throw new l(c);};try{e.open("GET",c,!0),e.send()}catch(r){throw new l(c,
2);}},k=function(c){c.change&&this.board.update(c.change);this.temp_marks&&this.board.removeObject(this.temp_marks);var a=[];this.notification();c.node.move&&this.config.markLastMove&&(c.node.move.pass?this.notification(b.t((c.node.move.c==b.B?"b":"w")+"pass")):a.push({type:"CR",x:c.node.move.x,y:c.node.move.y}));if(1<c.node.children.length&&this.config.displayVariations)for(var e=0;e<c.node.children.length;e++)c.node.children[e].move&&!c.node.children[e].move.pass&&a.push({type:"LB",text:String.fromCharCode(65+
e),x:c.node.children[e].move.x,y:c.node.children[e].move.y,c:this.board.theme.variationColor||"rgba(0,32,128,0.8)"});if(c.node.markup){for(e in c.node.markup)for(var g=0;g<a.length;g++)c.node.markup[e].x==a[g].x&&c.node.markup[e].y==a[g].y&&(a.splice(g,1),g--);a=a.concat(c.node.markup)}this.temp_marks=a;this.board.addObject(a)},h=function(c){this.board.setSize(c.kifu.size);this.board.removeAllObjects();this.config.enableWheel&&this.setWheel(!0)},m=function(c,a){return c==a.element||c==a.element?!1:
c._wgo_scrollable||c.scrollHeight>c.offsetHeight&&"auto"==window.getComputedStyle(c).overflow?!0:m(c.parentNode,a)},d=function(c){var a=c.wheelDelta||-1*c.detail;return m(c.target,this)?!0:0>a?(this.next(),this.config.lockScroll&&c.preventDefault&&c.preventDefault(),!this.config.lockScroll):0<a?(this.previous(),this.config.lockScroll&&c.preventDefault&&c.preventDefault(),!this.config.lockScroll):!0},a=function(c){if(document.querySelector("input:focus, textarea:focus"))return!0;switch(c.keyCode){case 39:this.next();
break;case 37:this.previous();break;default:return!0}this.config.lockScroll&&c.preventDefault&&c.preventDefault();return!this.config.lockScroll},g=function(c,a){if(!this.kifuReader||!this.kifuReader.node)return!1;for(var e in this.kifuReader.node.children)if(this.kifuReader.node.children[e].move&&this.kifuReader.node.children[e].move.x==c&&this.kifuReader.node.children[e].move.y==a){this.next(e);break}},p=function(c){this.config=c;for(var a in p.default)void 0===this.config[a]&&void 0!==p.default[a]&&
(this.config[a]=p.default[a]);this.element=document.createElement("div");this.board=new b.Board(this.element,this.config.board);this.init();this.initGame()};p.prototype={constructor:p,init:function(){this.kifu=null;this.listeners={kifuLoaded:[h.bind(this)],update:[k.bind(this)],frozen:[],unfrozen:[]};this.config.kifuLoaded&&this.addEventListener("kifuLoaded",this.config.kifuLoaded);this.config.update&&this.addEventListener("update",this.config.update);this.config.frozen&&this.addEventListener("frozen",
this.config.frozen);this.config.unfrozen&&this.addEventListener("unfrozen",this.config.unfrozen);this.board.addEventListener("click",g.bind(this));this.element.addEventListener("click",this.focus.bind(this));this.focus()},initGame:function(){this.config.sgf?this.loadSgf(this.config.sgf,this.config.move):this.config.json?this.loadJSON(this.config.json,this.config.move):this.config.sgfFile&&this.loadSgfFromFile(this.config.sgfFile,this.config.move)},update:function(c){this.kifuReader&&this.kifuReader.change&&
(c={type:"update",op:c,target:this,node:this.kifuReader.node,position:this.kifuReader.getPosition(),path:this.kifuReader.path,change:this.kifuReader.change},this.dispatchEvent(c))},loadKifu:function(c,a){this.kifu=c;this.kifuReader=new b.KifuReader(this.kifu,this.config.rememberPath,this.config.allowIllegalMoves);this.dispatchEvent({type:"kifuLoaded",target:this,kifu:this.kifu});this.update("init");a&&this.goTo(a)},loadSgf:function(c,a){try{this.loadKifu(b.Kifu.fromSgf(c),a)}catch(u){this.error(u)}},
loadJSON:function(c,a){try{this.loadKifu(b.Kifu.fromJGO(c),a)}catch(u){this.error(u)}},loadSgfFromFile:function(c,a){var e=this;try{f(c,function(c){e.loadSgf(c,a)})}catch(r){this.error(r)}},addEventListener:function(c,a){this.listeners[c]=this.listeners[c]||[];this.listeners[c].push(a)},removeEventListener:function(c,a){this.listeners[c]&&(a=this.listeners[c].indexOf(a),-1!=a&&this.listeners[c].splice(a,1))},dispatchEvent:function(c){if(this.listeners[c.type])for(var a in this.listeners[c.type])this.listeners[c.type][a](c)},
notification:function(c){console&&c&&console.log(c)},help:function(c){console&&console.log(c)},error:function(c){if(!b.ERROR_REPORT)throw c;console&&console.log(c)},next:function(c){if(!this.frozen&&this.kifu)try{this.kifuReader.next(c),this.update()}catch(q){this.error(q)}},previous:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.previous(),this.update()}catch(c){this.error(c)}},last:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.last(),this.update()}catch(c){this.error(c)}},
first:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.first(),this.update()}catch(c){this.error(c)}},goTo:function(c){if(!this.frozen&&this.kifu){"function"==typeof c&&(c=c.call(this));if("number"==typeof c){var a=b.clone(this.kifuReader.path);a.m=c||0}else a=c;try{this.kifuReader.goTo(a),this.update()}catch(u){this.error(u)}}},getGameInfo:function(){if(!this.kifu)return null;var c={},a;for(a in this.kifu.info)-1!=b.Kifu.infoList.indexOf(a)&&(b.Kifu.infoFormatters[a]?c[b.t(a)]=b.Kifu.infoFormatters[a](this.kifu.info[a]):
c[b.t(a)]=b.filterHTML(this.kifu.info[a]));return c},setFrozen:function(a){this.frozen=a;this.dispatchEvent({type:this.frozen?"frozen":"unfrozen",target:this})},appendTo:function(a){a.appendChild(this.element)},focus:function(){this.config.enableKeys&&this.setKeys(!0)},setKeys:function(c){document.onkeydown=c?a.bind(this):null},setWheel:function(a){!this._wheel_listener&&a?(this._wheel_listener=d.bind(this),a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.addEventListener(a,
this._wheel_listener)):this._wheel_listener&&!a&&(a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.removeEventListener(a,this._wheel_listener),delete this._wheel_listener)},setCoordinates:function(a){!this.coordinates&&a?(this.board.setSection(-.5,-.5,-.5,-.5),this.board.addCustomObject(b.Board.coordinates)):this.coordinates&&!a&&(this.board.setSection(0,0,0,0),this.board.removeCustomObject(b.Board.coordinates));this.coordinates=a}};p.default={sgf:void 0,json:void 0,sgfFile:void 0,
move:void 0,board:{},enableWheel:!0,lockScroll:!0,enableKeys:!0,rememberPath:!0,kifuLoaded:void 0,update:void 0,frozen:void 0,unfrozen:void 0,allowIllegalMoves:!1,markLastMove:!0,displayVariations:!0};b.Player=p;var e={"about-text":"<h1>WGo.js Player 2.0</h1><p>WGo.js Player is extension of WGo.js, HTML5 library for purposes of game of go. It allows to replay go game records and it has many features like score counting. It is also designed to be easily extendable.</p><p>WGo.js is open source licensed under <a href='http://en.wikipedia.org/wiki/MIT_License' target='_blank'>MIT license</a>. You can use and modify any code from this project.</p><p>You can find more information at <a href='http://wgo.waltheri.net/player' target='_blank'>wgo.waltheri.net/player</a></p><p>Copyright &copy; 2013 Jan Prokop</p>",
black:"Black",white:"White",DT:"Date",KM:"Komi",HA:"Handicap",AN:"Annotations",CP:"Copyright",GC:"Game comments",GN:"Game name",ON:"Fuseki",OT:"Overtime",TM:"Basic time",RE:"Result",RO:"Round",RU:"Rules",US:"Recorder",PC:"Place",EV:"Event",SO:"Source",none:"none",bpass:"Black passed.",wpass:"White passed."},v;for(v in e)b.i18n.en[v]=e[v]})(WGo);(function(b){var l=0,f=function(b,d,a){var g={};g.element=document.createElement("div");g.element.className="wgo-player-"+b;g.wrapper=document.createElement("div");g.wrapper.className="wgo-player-"+b+"-wrapper";g.element.appendChild(g.wrapper);d.appendChild(g.element);a||(g.element.style.display="none");return g},k=function(b){var d;if(d=this.currentLayout.layout?this.currentLayout.layout[b]:this.currentLayout[b]){this.regions[b].element.style.display="block";d.constructor!=Array&&(d=[d]);for(var a in d)this.components[d[a]]||
(this.components[d[a]]=new h.component[d[a]](this)),this.components[d[a]].appendTo(this.regions[b].wrapper),this.components[d[a]]._detachFromPlayer=!1}else this.regions[b].element.style.display="none"},h=b.extendClass(b.Player,function(m,d){this.config=d;for(var a in h.default)void 0===this.config[a]&&void 0!==h.default[a]&&(this.config[a]=h.default[a]);for(a in b.Player.default)void 0===this.config[a]&&void 0!==b.Player.default[a]&&(this.config[a]=b.Player.default[a]);this.element=m;this.element.innerHTML=
"";this.classes=(this.element.className?this.element.className+" ":"")+"wgo-player-main";this.element.className=this.classes;this.element.id||(this.element.id="wgo_"+l++);this.dom={};this.dom.center=document.createElement("div");this.dom.center.className="wgo-player-center";this.dom.board=document.createElement("div");this.dom.board.className="wgo-player-board";this.regions={};this.regions.left=f("left",this.element);this.element.appendChild(this.dom.center);this.regions.right=f("right",this.element);
this.regions.top=f("top",this.dom.center);this.dom.center.appendChild(this.dom.board);this.regions.bottom=f("bottom",this.dom.center);this.board=new b.Board(this.dom.board,this.config.board);this.init();this.components={};window.addEventListener("resize",function(){this.noresize||this.updateDimensions()}.bind(this));this.updateDimensions();this.initGame()});h.prototype.appendTo=function(b){b.appendChild(this.element);this.updateDimensions()};h.prototype.updateDimensions=function(){for(var b=window.getComputedStyle(this.element),
d=[];this.element.firstChild;)d.push(this.element.firstChild),this.element.removeChild(this.element.firstChild);var a=parseInt(b.width),g=parseInt(b.height),f=parseInt(b.maxHeight)||0;for(b=0;b<d.length;b++)this.element.appendChild(d[b]);if(a!=this.width||g!=this.height||f!=this.maxHeight){this.width=a;this.height=g;this.maxHeight=f;a:if(d=this.config.layout,d.constructor==Array){a=this.height||this.maxHeight;for(g=0;g<d.length;g++)if(!d[g].conditions||!(d[g].conditions.minWidth&&!(d[g].conditions.minWidth<=
this.width)||d[g].conditions.minHeight&&a&&!(d[g].conditions.minHeight<=a)||d[g].conditions.maxWidth&&!(d[g].conditions.maxWidth>=this.width)||d[g].conditions.maxHeight&&a&&!(d[g].conditions.maxHeight>=a)||d[g].conditions.custom&&!d[g].conditions.custom.call(this))){d=d[g];break a}d=void 0}if((this.currentLayout=d)&&this.lastLayout!=this.currentLayout){this.element.className=this.currentLayout.className?this.classes+" "+this.currentLayout.className:this.classes;for(var e in this.components)this.components[e]._detachFromPlayer=
!0;k.call(this,"left");k.call(this,"right");k.call(this,"top");k.call(this,"bottom");for(e in this.components)this.components[e]._detachFromPlayer&&this.components[e].element.parentNode&&this.components[e].element.parentNode.removeChild(this.components[e].element);this.lastLayout=this.currentLayout}d=this.dom.board.clientWidth;(e=this.height||this.maxHeight)&&(e-=this.regions.top.element.offsetHeight+this.regions.bottom.element.offsetHeight);e&&e<d?e!=this.board.height&&this.board.setHeight(e):d!=
this.board.width&&this.board.setWidth(d);d=e-d;0<d?(this.dom.board.style.height=e+"px",this.dom.board.style.paddingTop=d/2+"px"):(this.dom.board.style.height="auto",this.dom.board.style.paddingTop="0");this.regions.left.element.style.height=this.dom.center.offsetHeight+"px";this.regions.right.element.style.height=this.dom.center.offsetHeight+"px";for(b in this.components)this.components[b].updateDimensions&&this.components[b].updateDimensions()}};h.prototype.showMessage=function(m,d,a){this.info_overlay=
document.createElement("div");this.info_overlay.style.width=this.element.offsetWidth+"px";this.info_overlay.style.height=this.element.offsetHeight+"px";this.info_overlay.className="wgo-info-overlay";this.element.appendChild(this.info_overlay);var g=document.createElement("div");g.className="wgo-info-message";g.innerHTML=m;m=document.createElement("div");m.className="wgo-info-close";a||(m.innerHTML=b.t("BP:closemsg"));g.appendChild(m);this.info_overlay.appendChild(g);d?this.info_overlay.addEventListener("click",
function(a){d(a)}):a||this.info_overlay.addEventListener("click",function(a){this.hideMessage()}.bind(this));this.setFrozen(!0)};h.prototype.hideMessage=function(){this.element.removeChild(this.info_overlay);this.setFrozen(!1)};h.prototype.error=function(m){if(!b.ERROR_REPORT)throw m;switch(m.name){case "InvalidMoveError":this.showMessage("<h1>"+m.name+"</h1><p>"+m.message+'</p><p>If this message isn\'t correct, please report it by clicking <a href="#">here</a>, otherwise contact maintainer of this site.</p>');
break;case "FileError":this.showMessage("<h1>"+m.name+"</h1><p>"+m.message+"</p><p>Please contact maintainer of this site. Note: it is possible to read files only from this host.</p>");break;default:this.showMessage("<h1>"+m.name+"</h1><p>"+m.message+"</p><pre>"+m.stacktrace+'</pre><p>Please contact maintainer of this site. You can also report it <a href="#">here</a>.</p>')}};h.component={};h.layouts={one_column:{top:[],bottom:[]},no_comment:{top:[],bottom:[]},right_top:{top:[],right:[]},right:{right:[]},
minimal:{bottom:[]}};h.dynamicLayout=[{conditions:{minWidth:650},layout:h.layouts.right_top,className:"wgo-twocols wgo-large"},{conditions:{minWidth:550,minHeight:600},layout:h.layouts.one_column,className:"wgo-medium"},{conditions:{minWidth:350},layout:h.layouts.no_comment,className:"wgo-small"},{layout:h.layouts.no_comment,className:"wgo-xsmall"}];h.default={layout:h.dynamicLayout};b.i18n.en["BP:closemsg"]="click anywhere to close this window";h.attributes={"data-wgo":function(b){b&&("("==b[0]?
this.sgf=b:this.sgfFile=b)},"data-wgo-board":function(b){this.board=eval("({"+b+"})")},"data-wgo-onkifuload":function(b){this.kifuLoaded=new Function(b)},"data-wgo-onupdate":function(b){this.update=new Function(b)},"data-wgo-onfrozen":function(b){this.frozen=new Function(b)},"data-wgo-onunfrozen":function(b){this.unfrozen=new Function(b)},"data-wgo-layout":function(b){this.layout=eval("({"+b+"})")},"data-wgo-enablewheel":function(b){"false"==b.toLowerCase()&&(this.enableWheel=!1)},"data-wgo-lockscroll":function(b){"false"==
b.toLowerCase()&&(this.lockScroll=!1)},"data-wgo-enablekeys":function(b){"false"==b.toLowerCase()&&(this.enableKeys=!1)},"data-wgo-rememberpath":function(b){"false"==b.toLowerCase()&&(this.rememberPath=!1)},"data-wgo-allowillegal":function(b){"false"!=b.toLowerCase()&&(this.allowIllegalMoves=!0)},"data-wgo-move":function(b){var d=parseInt(b);isNaN(d)?this.move=eval("({"+b+"})"):this.move=d},"data-wgo-marklastmove":function(b){"false"==b.toLowerCase()&&(this.markLastMove=!1)},"data-wgo-diagram":function(b){b&&
("("==b[0]?this.sgf=b:this.sgfFile=b,this.enableWheel=this.enableKeys=this.markLastMove=!1,this.layout={top:[],right:[],left:[],bottom:[]})}};b.BasicPlayer=h;window.addEventListener("load",function(){for(var b=document.querySelectorAll("[data-wgo],[data-wgo-diagram]"),d=0;d<b.length;d++){var a=b[d];var g={};for(var f=0;f<a.attributes.length;f++){var e=a.attributes[f];h.attributes[e.name]&&h.attributes[e.name].call(g,e.value,e.name)}g=new h(a,g);a._wgo_player=g}})})(WGo);(function(b,l){l=function(){this.element=document.createElement("div")};l.prototype={constructor:l,appendTo:function(b){b.appendChild(this.element)},getWidth:function(){var b=window.getComputedStyle(this.element);return parseInt(b.width)},getHeight:function(){var b=window.getComputedStyle(this.element);return parseInt(b.height)},updateDimensions:function(){}};b.BasicPlayer.component.Component=l})(WGo);(function(){var b=function(a){this[a]={};var b=this[a];b.box=document.createElement("div");b.box.className="wgo-box-wrapper wgo-player-wrapper wgo-"+a;b.name=document.createElement("div");b.name.className="wgo-box-title";b.name.innerHTML=a;b.box.appendChild(b.name);a=document.createElement("div");a.className="wgo-player-info";b.box.appendChild(a);b.info={};b.info.rank=l("rank");b.info.rank.val.innerHTML="-";b.info.caps=l("caps");b.info.caps.val.innerHTML="0";b.info.time=l("time");b.info.time.val.innerHTML=
"--:--";a.appendChild(b.info.rank.wrapper);a.appendChild(b.info.caps.wrapper);a.appendChild(b.info.time.wrapper)},l=function(a){var b={};b.wrapper=document.createElement("div");b.wrapper.className="wgo-player-info-box-wrapper";b.box=document.createElement("div");b.box.className="wgo-player-info-box";b.wrapper.appendChild(b.box);b.title=document.createElement("div");b.title.className="wgo-player-info-title";b.title.innerHTML=WGo.t(a);b.box.appendChild(b.title);b.val=document.createElement("div");b.val.className=
"wgo-player-info-value";b.box.appendChild(b.val);return b},f=function(a){a=a.kifu.info||{};a.black?(this.black.name.innerHTML=WGo.filterHTML(a.black.name)||WGo.t("black"),this.black.info.rank.val.innerHTML=WGo.filterHTML(a.black.rank)||"-"):(this.black.name.innerHTML=WGo.t("black"),this.black.info.rank.val.innerHTML="-");a.white?(this.white.name.innerHTML=WGo.filterHTML(a.white.name)||WGo.t("white"),this.white.info.rank.val.innerHTML=WGo.filterHTML(a.white.rank)||"-"):(this.white.name.innerHTML=WGo.t("white"),
this.white.info.rank.val.innerHTML="-");this.black.info.caps.val.innerHTML="0";this.white.info.caps.val.innerHTML="0";a.TM?(this.setPlayerTime("black",a.TM),this.setPlayerTime("white",a.TM)):(this.black.info.time.val.innerHTML="--:--",this.white.info.time.val.innerHTML="--:--");this.updateDimensions()},k=function(a){if(a.style.fontSize){var b=parseInt(a.style.fontSize);a.style.fontSize="";var d=window.getComputedStyle(a);d=parseInt(d.fontSize);a.style.fontSize=b+"px"}else d=window.getComputedStyle(a),
d=b=parseInt(d.fontSize);if(!(b==d&&a.scrollHeight<=a.offsetHeight))if(a.scrollHeight>a.offsetHeight)for(b-=2;a.scrollHeight>a.offsetHeight&&1<b;)a.style.fontSize=b+"px",b-=2;else if(b<d){for(b+=2;a.scrollHeight<=a.offsetHeight&&b<=d;)a.style.fontSize=b+"px",b+=2;a.scrollHeight>a.offsetHeight&&(a.style.fontSize=b-4+"px")}},h=function(a){a.node.BL&&this.setPlayerTime("black",a.node.BL);a.node.WL&&this.setPlayerTime("white",a.node.WL);void 0!==a.position.capCount.black&&(this.black.info.caps.val.innerHTML=
a.position.capCount.black);void 0!==a.position.capCount.white&&(this.white.info.caps.val.innerHTML=a.position.capCount.white)},m=WGo.extendClass(WGo.BasicPlayer.component.Component,function(a){this.super(a);this.element.className="wgo-infobox";b.call(this,"white");b.call(this,"black");this.element.appendChild(this.white.box);this.element.appendChild(this.black.box);a.addEventListener("kifuLoaded",f.bind(this));a.addEventListener("update",h.bind(this))});m.prototype.setPlayerTime=function(a,b){var d=
Math.round(b)%60;this[a].info.time.val.innerHTML=Math.floor(b/60)+":"+(10>d?"0"+d:d)};m.prototype.updateDimensions=function(){k(this.black.name);k(this.white.name)};var d=WGo.BasicPlayer.layouts;d.right_top.right.push("InfoBox");d.right.right.push("InfoBox");d.one_column.top.push("InfoBox");d.no_comment.top.push("InfoBox");WGo.i18n.en.rank="Rank";WGo.i18n.en.caps="Caps";WGo.i18n.en.time="Time";WGo.BasicPlayer.component.InfoBox=m})(WGo);(function(b,l){var f=function(b){var a=b.charCodeAt(0)-97;0>a&&(a+=32);7<a&&a--;var d=b.charCodeAt(1)-48;2<b.length&&(d=10*d+(b.charCodeAt(2)-48));d=this.kifuReader.game.size-d;this._tmp_mark={type:"MA",x:a,y:d};this.board.addObject(this._tmp_mark)},k=function(){this.board.removeObject(this._tmp_mark);delete this._tmp_mark},h=function(b,a){for(var d in b)b[d].className&&"wgo-move-link"==b[d].className?(b[d].addEventListener("mouseover",f.bind(a,b[d].innerHTML)),b[d].addEventListener("mouseout",k.bind(a))):
b[d].childNodes&&b[d].childNodes.length&&h(b[d].childNodes,a)},m=function(d,a){var g='<div class="wgo-info-list">';a&&(g+='<div class="wgo-info-title">'+b.t("gameinfo")+"</div>");for(var f in d)g+='<div class="wgo-info-item"><span class="wgo-info-label">'+f+'</span><span class="wgo-info-value">'+d[f]+"</span></div>";return g+"</div>"};l=b.extendClass(b.BasicPlayer.component.Component,function(d){this.super(d);this.player=d;this.element.className="wgo-commentbox";this.box=document.createElement("div");
this.box.className="wgo-box-wrapper wgo-comments-wrapper";this.element.appendChild(this.box);this.comments_title=document.createElement("div");this.comments_title.className="wgo-box-title";this.comments_title.innerHTML=b.t("comments");this.box.appendChild(this.comments_title);this.comments=document.createElement("div");this.comments.className="wgo-comments-content";this.box.appendChild(this.comments);this.help=document.createElement("div");this.help.className="wgo-help";this.help.style.display="none";
this.comments.appendChild(this.help);this.notification=document.createElement("div");this.notification.className="wgo-notification";this.notification.style.display="none";this.comments.appendChild(this.notification);this.comment_text=document.createElement("div");this.comment_text.className="wgo-comment-text";this.comments.appendChild(this.comment_text);d.addEventListener("kifuLoaded",function(a){a.kifu.hasComments()?(this.comments_title.innerHTML=b.t("comments"),this.element.className="wgo-commentbox",
this._update=function(a){this.setComments(a)}.bind(this),d.addEventListener("update",this._update)):(this.comments_title.innerHTML=b.t("gameinfo"),this.element.className="wgo-commentbox wgo-gameinfo",this._update&&(d.removeEventListener("update",this._update),delete this._update),this.comment_text.innerHTML=m(a.target.getGameInfo()))}.bind(this));d.notification=function(a){a?(this.notification.style.display="block",this.notification.innerHTML=a,this.is_notification=!0):(this.notification.style.display=
"none",this.is_notification=!1)}.bind(this);d.help=function(a){a?(this.help.style.display="block",this.help.innerHTML=a,this.is_help=!0):(this.help.style.display="none",this.is_help=!1)}.bind(this)});l.prototype.setComments=function(b){this.player._tmp_mark&&k.call(this.player);var a="";b.node.parent||(a=m(b.target.getGameInfo(),!0));this.comment_text.innerHTML=a+this.getCommentText(b.node.comment,this.player.config.formatNicks,this.player.config.formatMoves);this.player.config.formatMoves&&this.comment_text.childNodes&&
this.comment_text.childNodes.length&&h(this.comment_text.childNodes,this.player)};l.prototype.getCommentText=function(d,a,g){return d?(d="<p>"+b.filterHTML(d).replace(/\n/g,"</p><p>")+"</p>",a&&(d=d.replace(/(<p>)([^:]{3,}:)\s/g,'<p><span class="wgo-comments-nick">$2</span> ')),g&&(d=d.replace(/\b[a-zA-Z]1?\d\b/g,'<a href="javascript:void(0)" class="wgo-move-link">$&</a>')),d):""};b.BasicPlayer.default.formatNicks=!0;b.BasicPlayer.default.formatMoves=!0;b.BasicPlayer.attributes["data-wgo-formatnicks"]=
function(b){"false"==b.toLowerCase()&&(this.formatNicks=!1)};b.BasicPlayer.attributes["data-wgo-formatmoves"]=function(b){"false"==b.toLowerCase()&&(this.formatMoves=!1)};b.BasicPlayer.layouts.right_top.right.push("CommentBox");b.BasicPlayer.layouts.right.right.push("CommentBox");b.BasicPlayer.layouts.one_column.bottom.push("CommentBox");b.i18n.en.comments="Comments";b.i18n.en.gameinfo="Game info";b.BasicPlayer.component.CommentBox=l})(WGo);(function(b,l){var f=b.extendClass(b.BasicPlayer.component.Component,function(a){this.super(a);this.widgets=[];this.element.className="wgo-player-control";this.iconBar=document.createElement("div");this.iconBar.className="wgo-control-wrapper";this.element.appendChild(this.iconBar);var b;for(b in f.widgets){var c=new f.widgets[b].constructor(a,f.widgets[b].args);c.appendTo(this.iconBar);this.widgets.push(c)}});f.prototype.updateDimensions=function(){this.element.className=340>this.element.clientWidth?
"wgo-player-control wgo-340":440>this.element.clientWidth?"wgo-player-control wgo-440":"wgo-player-control"};var k=b.BasicPlayer.control={},h=function(a){a.node.parent||this.disabled?a.node.parent&&this.disabled&&this.enable():this.disable()},m=function(a){a.node.children.length||this.disabled?a.node.children.length&&this.disabled&&this.enable():this.disable()},d=function(a){(this._disabled=this.disabled)||this.disable()},a=function(a){this._disabled||this.enable();delete this._disabled};k.Widget=
function(a,b){this.element=this.element||document.createElement(b.type||"div");this.element.className="wgo-widget-"+b.name;this.init(a,b)};k.Widget.prototype={constructor:k.Widget,init:function(a,b){b&&(b.disabled&&this.disable(),b.init&&b.init.call(this,a))},appendTo:function(a){a.appendChild(this.element)},disable:function(){this.disabled=!0;-1==this.element.className.search("wgo-disabled")&&(this.element.className+=" wgo-disabled")},enable:function(){this.disabled=!1;this.element.className=this.element.className.replace(" wgo-disabled",
"");this.element.disabled=""}};k.Group=b.extendClass(k.Widget,function(a,b){this.element=document.createElement("div");this.element.className="wgo-ctrlgroup wgo-ctrlgroup-"+b.name;var c;for(c in b.widgets){var e=new b.widgets[c].constructor(a,b.widgets[c].args);e.appendTo(this.element)}});k.Clickable=b.extendClass(k.Widget,function(a,b){this.super(a,b)});k.Clickable.prototype.init=function(a,b){var c=this;var e=b.togglable?function(){c.disabled||(b.click.call(c,a)?c.select():c.unselect())}:function(){c.disabled||
b.click.call(c,a)};this.element.addEventListener("click",e);this.element.addEventListener("touchstart",function(a){a.preventDefault();e();b.multiple&&(c._touch_i=0,c._touch_int=window.setInterval(function(){500<c._touch_i&&e();c._touch_i+=100},100));return!1});b.multiple&&this.element.addEventListener("touchend",function(a){window.clearInterval(c._touch_int)});b.disabled&&this.disable();b.init&&b.init.call(this,a)};k.Clickable.prototype.select=function(){this.selected=!0;-1==this.element.className.search("wgo-selected")&&
(this.element.className+=" wgo-selected")};k.Clickable.prototype.unselect=function(){this.selected=!1;this.element.className=this.element.className.replace(" wgo-selected","")};k.Button=b.extendClass(k.Clickable,function(a,d){var c=this.element=document.createElement("button");c.className="wgo-button wgo-button-"+d.name;c.title=b.t(d.name);this.init(a,d)});k.Button.prototype.disable=function(){k.Button.prototype.super.prototype.disable.call(this);this.element.disabled="disabled"};k.Button.prototype.enable=
function(){k.Button.prototype.super.prototype.enable.call(this);this.element.disabled=""};k.MenuItem=b.extendClass(k.Clickable,function(a,d){var c=this.element=document.createElement("div");c.className="wgo-menu-item wgo-menu-item-"+d.name;c.title=b.t(d.name);c.innerHTML=c.title;this.init(a,d)});k.MoveNumber=b.extendClass(k.Widget,function(a){this.element=document.createElement("form");this.element.className="wgo-player-mn-wrapper";var b=this.move=document.createElement("input");b.type="text";b.value=
"0";b.maxlength=3;b.className="wgo-player-mn-value";this.element.appendChild(b);this.element.onsubmit=b.onchange=function(a){a.goTo(this.getValue());return!1}.bind(this,a);a.addEventListener("update",function(a){this.setValue(a.path.m)}.bind(this));a.addEventListener("kifuLoaded",this.enable.bind(this));a.addEventListener("frozen",this.disable.bind(this));a.addEventListener("unfrozen",this.enable.bind(this))});k.MoveNumber.prototype.disable=function(){k.MoveNumber.prototype.super.prototype.disable.call(this);
this.move.disabled="disabled"};k.MoveNumber.prototype.enable=function(){k.MoveNumber.prototype.super.prototype.enable.call(this);this.move.disabled=""};k.MoveNumber.prototype.setValue=function(a){this.move.value=a};k.MoveNumber.prototype.getValue=function(){return parseInt(this.move.value)};var g=function(a){if(a._menu_tmp)delete a._menu_tmp;else{if(!a.menu)for(c in a.menu=document.createElement("div"),a.menu.className="wgo-player-menu",a.menu.style.position="absolute",a.menu.style.display="none",
this.element.parentElement.appendChild(a.menu),f.menu){var b=new f.menu[c].constructor(a,f.menu[c].args,!0);b.appendTo(a.menu)}if("none"!=a.menu.style.display)return a.menu.style.display="none",document.removeEventListener("click",a._menu_ev),delete a._menu_ev,this.unselect(),!1;a.menu.style.display="block";b=this.element.offsetTop;var c=this.element.offsetLeft;this.element.parentElement.parentElement.parentElement.parentElement==a.regions.bottom.wrapper?(a.menu.style.left=c+"px",a.menu.style.top=
b-a.menu.offsetHeight+1+"px"):(a.menu.style.left=c+"px",a.menu.style.top=b+this.element.offsetHeight+"px");a._menu_ev=g.bind(this,a);a._menu_tmp=!0;document.addEventListener("click",a._menu_ev);return!0}};f.menu=[{constructor:k.MenuItem,args:{name:"switch-coo",togglable:!0,click:function(a){a.setCoordinates(!a.coordinates);return a.coordinates},init:function(a){a.coordinates&&this.select()}}}];f.widgets=[{constructor:k.Group,args:{name:"left",widgets:[{constructor:k.Button,args:{name:"menu",togglable:!0,
click:g}}]}},{constructor:k.Group,args:{name:"right",widgets:[{constructor:k.Button,args:{name:"about",click:function(a){a.showMessage(b.t("about-text"))}}}]}},{constructor:k.Group,args:{name:"control",widgets:[{constructor:k.Button,args:{name:"first",disabled:!0,init:function(b){b.addEventListener("update",h.bind(this));b.addEventListener("frozen",d.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){a.first()}}},{constructor:k.Button,args:{name:"multiprev",disabled:!0,multiple:!0,
init:function(b){b.addEventListener("update",h.bind(this));b.addEventListener("frozen",d.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){var d=b.clone(a.kifuReader.path);d.m-=10;a.goTo(d)}}},{constructor:k.Button,args:{name:"previous",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",h.bind(this));b.addEventListener("frozen",d.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){a.previous()}}},{constructor:k.MoveNumber},{constructor:k.Button,
args:{name:"next",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",m.bind(this));b.addEventListener("frozen",d.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){a.next()}}},{constructor:k.Button,args:{name:"multinext",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",m.bind(this));b.addEventListener("frozen",d.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){var d=b.clone(a.kifuReader.path);d.m+=10;a.goTo(d)}}},
{constructor:k.Button,args:{name:"last",disabled:!0,init:function(b){b.addEventListener("update",m.bind(this));b.addEventListener("frozen",d.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){a.last()}}}]}}];l=b.BasicPlayer.layouts;l.right_top.top.push("Control");l.right.right.push("Control");l.one_column.top.push("Control");l.no_comment.bottom.push("Control");l.minimal.bottom.push("Control");l={about:"About",first:"First",multiprev:"10 moves back",previous:"Previous",next:"Next",
multinext:"10 moves forward",last:"Last","switch-coo":"Display coordinates",menu:"Menu"};for(var p in l)b.i18n.en[p]=l[p];b.BasicPlayer.component.Control=f})(WGo);(function(b){var l=function(b,f){this.player.frozen||this._lastX==b&&this._lastY==f||(this._lastX=b,this._lastY=f,this._last_mark&&this.board.removeObject(this._last_mark),-1!=b&&-1!=f&&this.player.kifuReader.game.isValid(b,f)?(this._last_mark={type:"outline",x:b,y:f,c:this.player.kifuReader.game.turn},this.board.addObject(this._last_mark)):delete this._last_mark)},f=function(){this._last_mark&&(this.board.removeObject(this._last_mark),delete this._last_mark,delete this._lastX,delete this._lastY)};
b.Player.Editable={};b.Player.Editable=function(b,f){this.player=b;this.board=f;this.editMode=!1};b.Player.Editable.prototype.set=function(k){if(!this.editMode&&k)this.originalReader=this.player.kifuReader,this.player.kifuReader=new b.KifuReader(this.player.kifu.clone(),this.originalReader.rememberPath,this.originalReader.allow_illegal,this.originalReader.allow_illegal),this.player.kifuReader.goTo(this.originalReader.path),this._ev_click=this._ev_click||this.play.bind(this),this._ev_move=this._ev_move||
l.bind(this),this._ev_out=this._ev_out||f.bind(this),this.board.addEventListener("click",this._ev_click),this.board.addEventListener("mousemove",this._ev_move),this.board.addEventListener("mouseout",this._ev_out),this.editMode=!0;else if(this.editMode&&!k){this.originalReader.goTo(this.player.kifuReader.path);k=this.originalReader;for(var h=this.player.kifuReader.getPosition(),m=this.originalReader.getPosition(),d=h.size,a=[],g=[],p=0;p<d*d;p++)h.schema[p]&&!m.schema[p]?g.push({x:Math.floor(p/d),
y:p%d}):h.schema[p]!=m.schema[p]&&a.push({x:Math.floor(p/d),y:p%d,c:m.schema[p]});k.change={add:a,remove:g};this.player.kifuReader=this.originalReader;this.player.update(!0);this.board.removeEventListener("click",this._ev_click);this.board.removeEventListener("mousemove",this._ev_move);this.board.removeEventListener("mouseout",this._ev_out);this.editMode=!1}};b.Player.Editable.prototype.play=function(f,l){!this.player.frozen&&this.player.kifuReader.game.isValid(f,l)&&(this.player.kifuReader.node.appendChild(new b.KNode({move:{x:f,
y:l,c:this.player.kifuReader.game.turn},_edited:!0})),this.player.next(this.player.kifuReader.node.children.length-1))};b.BasicPlayer&&b.BasicPlayer.component.Control&&b.BasicPlayer.component.Control.menu.push({constructor:b.BasicPlayer.control.MenuItem,args:{name:"editmode",togglable:!0,click:function(f){this._editable=this._editable||new b.Player.Editable(f,f.board);this._editable.set(!this._editable.editMode);return this._editable.editMode},init:function(b){var f=this;b.addEventListener("frozen",
function(b){(f._disabled=f.disabled)||f.disable()});b.addEventListener("unfrozen",function(b){f._disabled||f.enable();delete f._disabled})}}});b.i18n.en.editmode="Edit mode"})(WGo);(function(b){var l=function(b,d,a,g){this.originalPosition=b;this.position=b.clone();this.board=d;this.komi=a;this.output=g},f=l.state={UNKNOWN:0,BLACK_STONE:1,WHITE_STONE:-1,BLACK_CANDIDATE:2,WHITE_CANDIDATE:-2,BLACK_NEUTRAL:3,WHITE_NEUTRAL:-3,NEUTRAL:4},k=function(b,d,a,g,f){var e=b.get(d,a);void 0!==e&&e!=g&&e!=f&&(b.set(d,a,g),k(b,d-1,a,g,f),k(b,d,a-1,g,f),k(b,d+1,a,g,f),k(b,d,a+1,g,f))},h=function(b,d,a,g,f){var e=d.get(a,g);b.get(a,g)!=e&&(b.set(a,g,e),h(b,d,a-1,g,f),h(b,d,a,g-1,f),h(b,d,a+
1,g,f),h(b,d,a,g+1,f))};l.prototype.start=function(){this.calculate();this.saved_state=this.board.getState();this.displayScore();this._click=function(m,d){var a=this.originalPosition.get(m,d);a==b.W?this.position.get(m,d)==f.WHITE_STONE?k(this.position,m,d,f.BLACK_CANDIDATE,f.BLACK_STONE):(h(this.position,this.originalPosition,m,d,f.BLACK_STONE),this.calculate()):a==b.B?this.position.get(m,d)==f.BLACK_STONE?k(this.position,m,d,f.WHITE_CANDIDATE,f.WHITE_STONE):(h(this.position,this.originalPosition,
m,d,f.WHITE_STONE),this.calculate()):(a=this.position.get(m,d),a==f.BLACK_CANDIDATE?this.position.set(m,d,f.BLACK_NEUTRAL):a==f.WHITE_CANDIDATE?this.position.set(m,d,f.WHITE_NEUTRAL):a==f.BLACK_NEUTRAL?this.position.set(m,d,f.BLACK_CANDIDATE):a==f.WHITE_NEUTRAL&&this.position.set(m,d,f.WHITE_CANDIDATE));this.board.restoreState({objects:b.clone(this.saved_state.objects)});this.displayScore()}.bind(this);this.board.addEventListener("click",this._click)};l.prototype.end=function(){this.board.restoreState({objects:b.clone(this.saved_state.objects)});
this.board.removeEventListener("click",this._click)};l.prototype.displayScore=function(){for(var m=[],d=[],a=[],g=[],k=[],e=[],l=[],c=0;c<this.position.size;c++)for(var h=0;h<this.position.size;h++)s=this.position.get(c,h),t=this.originalPosition.get(c,h),s==f.BLACK_CANDIDATE?m.push({x:c,y:h,type:"mini",c:b.B}):s==f.WHITE_CANDIDATE?d.push({x:c,y:h,type:"mini",c:b.W}):s==f.NEUTRAL&&a.push({x:c,y:h}),t==b.W&&s!=f.WHITE_STONE?k.push({x:c,y:h,type:"outline",c:b.W}):t==b.B&&s!=f.BLACK_STONE&&g.push({x:c,
y:h,type:"outline",c:b.B}),t==b.W&&s==f.WHITE_STONE?l.push({x:c,y:h,type:"outline",c:b.W}):t==b.B&&s==f.BLACK_STONE&&e.push({x:c,y:h,type:"outline",c:b.B});for(c=0;c<g.length;c++)this.board.removeObjectsAt(g[c].x,g[c].y);for(c=0;c<k.length;c++)this.board.removeObjectsAt(k[c].x,k[c].y);this.board.addObject(k);this.board.addObject(g);this.board.addObject(m);this.board.addObject(d);h="";a=m.length+e.length;c=d.length+l.length+parseFloat(this.komi);h+="<p style='font-weight: bold;'>Area "+b.t("RE")+"</p>";
h+=b.t("black")+": "+e.length+" + "+m.length+" = "+a+"</p>";h+=b.t("white")+": "+l.length+" + "+d.length+" + "+this.komi+" = "+c+"</p>";h=a>c?h+("<p style='font-weight: bold;'>"+b.t("bwin",a-c)+"</p>"):h+("<p style='font-weight: bold;'>"+b.t("wwin",c-a)+"</p>");h+="<p style='font-weight: bold;'>Territory "+b.t("RE")+"</p>";a=m.length+k.length+this.originalPosition.capCount.black;c=d.length+g.length+this.originalPosition.capCount.white+parseFloat(this.komi);h+="<p>"+b.t("black")+": "+m.length+" + "+
(k.length+this.originalPosition.capCount.black)+" = "+a+"</br>";h+=b.t("white")+": "+d.length+" + "+(g.length+this.originalPosition.capCount.white)+" + "+this.komi+" = "+c+"</p>";h=a>c?h+("<p style='font-weight: bold;'>"+b.t("bwin",a-c)+"</p>"):h+("<p style='font-weight: bold;'>"+b.t("wwin",c-a)+"</p>");this.output(h)};l.prototype.calculate=function(){var b,d;var a=this.position;for(d=!0;d;){d=!1;for(var g=0;g<a.size;g++)for(var k=0;k<a.size;k++){var e=a.get(k,g);if(e==f.UNKNOWN||e==f.BLACK_CANDIDATE||
e==f.WHITE_CANDIDATE){var h=[a.get(k-1,g),a.get(k,g-1),a.get(k+1,g),a.get(k,g+1)];var c=b=!1;for(var l=0;4>l;l++)h[l]==f.BLACK_STONE||h[l]==f.BLACK_CANDIDATE?b=!0:h[l]==f.WHITE_STONE||h[l]==f.WHITE_CANDIDATE?c=!0:h[l]==f.NEUTRAL&&(c=b=!0);h=!1;b&&c?h=f.NEUTRAL:b?h=f.BLACK_CANDIDATE:c&&(h=f.WHITE_CANDIDATE);h&&e!=h&&(d=!0,a.set(k,g,h))}}}};b.ScoreMode=l;b.BasicPlayer&&b.BasicPlayer.component.Control&&b.BasicPlayer.component.Control.menu.push({constructor:b.BasicPlayer.control.MenuItem,args:{name:"scoremode",
togglable:!0,click:function(f){if(this.selected)return f.setFrozen(!1),this._score_mode.end(),delete this._score_mode,f.notification(),f.help(),!1;f.setFrozen(!0);f.help("<p>"+b.t("help_score")+"</p>");this._score_mode=new b.ScoreMode(f.kifuReader.game.position,f.board,f.kifu.info.KM||.5,f.notification);this._score_mode.start();return!0}}});b.i18n.en.scoremode="Count score";b.i18n.en.score="Score";b.i18n.en.bwin="Black wins by $ points.";b.i18n.en.wwin="White wins by $ points.";b.i18n.en.help_score=
"Click on stones to mark them dead or alive. You can also set and unset territory points by clicking on them. Territories must be completely bordered."})(WGo);(function(b,l){var f={active:!0,query:{}},k=function(b){try{f.query=JSON.parse('{"'+window.location.hash.substr(1).replace("=",'":')+"}")}catch(d){f.query={}}};window.addEventListener("hashchange",function(){if(""!=window.location.hash&&f.active){k();for(var b in f.query){var d=document.getElementById(b);d&&d._wgo_player&&d._wgo_player.goTo(h)}}});window.addEventListener("DOMContentLoaded",function(){""!=window.location.hash&&f.active&&k()});window.addEventListener("load",function(){if(""!=window.location.hash&&
f.active)for(var b in f.query){var d=document.getElementById(b);if(d&&d._wgo_player){d.scrollIntoView();break}}});var h=function(){if(f.query[this.element.id])return f.query[this.element.id].goto};b.Player.default.move=h;b.BasicPlayer&&b.BasicPlayer.component.Control&&b.BasicPlayer.component.Control.menu.push({constructor:b.BasicPlayer.control.MenuItem,args:{name:"permalink",click:function(f){var d=location.href.split("#")[0]+"#"+f.element.id+'={"goto":'+JSON.stringify(f.kifuReader.path)+"}";f.showMessage("<h1>"+
b.t("permalink")+'</h1><p><input class="wgo-permalink" type="text" value=\''+d+'\' onclick="this.select(); event.stopPropagation()"/></p>')}}});b.Player.permalink=f;b.i18n.en.permalink="Permanent link"})(WGo);
